<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Task Manager</title>
    
    <!-- CSS Framework - Using a lightweight CSS framework for clean styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="src/styles/main.css">
</head>
<body style = "background-color: rgb(46, 47, 47);">
    <div class="container-fluid">
        <header class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
            <div class="container">
                <h1 class="navbar-brand mb-0">
                    <i class="fas fa-tasks me-2" ></i>
                    AI Task Manager
                </h1>
            </div>
        </header>

        <main class="container">
            <div class="row">
                <!-- Task Management Section -->
                <div class="col-lg-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h2 class="card-title mb-0">Tasks</h2>
                            <button id="add-task-btn" class="btn btn-success">
                                <i class="fas fa-plus me-1"></i>
                                Add Task
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- Task Form (initially hidden) -->
                            <div id="task-form-container" class="mb-3" style="display: none;">
                                <!-- Task form will be rendered here -->

                            </div>
                            
                            <!-- Task List -->
                            <div id="task-list-container">
                                <!-- Task list will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Recommendations Section -->
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title mb-0">
                                <i class="fas fa-robot me-2"></i>
                                AI Recommendations
                            </h3>
                        </div>
                        <div class="card-body">
                            <div id="ai-recommendations-container">
                                <p class="text-muted text-center">
                                    <i class="fas fa-lightbulb fa-2x mb-2 d-block"></i>
                                    Start a task to get AI-powered recommendations
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Application JavaScript Modules -->
   <script>
    let taskCounter = 1;

    const addTaskBtn = document.getElementById("add-task-btn");
    const taskFormContainer = document.getElementById("task-form-container");
    const taskListContainer = document.getElementById("task-list-container");
    const aiContainer = document.getElementById("ai-recommendations-container");

    // Show task input form
    addTaskBtn.addEventListener("click", () => {
        taskFormContainer.style.display = "block";
        taskFormContainer.innerHTML = `
            <div class="input-group">
                <input type="text" id="task-input" class="form-control" placeholder="Enter task">
                <button class="btn btn-primary" onclick="addTask()">Add</button>
            </div>
        `;
    });

    // Add task
    function addTask() {
        const input = document.getElementById("task-input");
        const text = input.value.trim();
        if (!text) return;

        const taskDiv = document.createElement("div");
        taskDiv.className = "card mb-2";
        taskDiv.id = `task-${taskCounter}`;

        taskDiv.innerHTML = `
            <div class="card-body d-flex justify-content-between align-items-center">
                <span id="task-text-${taskCounter}">
                    <strong>${taskCounter}.</strong> ${text}
                </span>
                <div>
                    <button class="btn btn-success btn-sm me-2" onclick="startTask(${taskCounter})">
                        <i class="fas fa-play"></i> Start
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteTask(${taskCounter})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;

        taskListContainer.appendChild(taskDiv);
        taskCounter++;
        input.value = "";
        taskFormContainer.style.display = "none";
    }

    // Delete task
    function deleteTask(id) {
        const el = document.getElementById(`task-${id}`);
        if (el) el.remove();
    }

    // START button logic
    function startTask(id) {
        const taskText = document.getElementById(`task-text-${id}`).innerText;

        aiContainer.innerHTML = `
            <p class="text-muted text-center">
                <i class="fas fa-spinner fa-spin"></i><br/>
                Sending task to agent...
            </p>
        `;

        // Send query to agent
        sendToAgent(taskText);
    }

   // REAL AGENT FUNCTION
    async function sendToAgent(query) {
        try {
            const response = await fetch('http://127.0.0.1:5000/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: query })
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            
            // Format the Markdown response for HTML display
            // This replaces newlines with <br> and preserves whitespace
            const formattedResponse = formatResponse(data.response);

            aiContainer.innerHTML = `
                <div class="alert alert-light border" style="max-height: 500px; overflow-y: auto;">
                    <h5 class="alert-heading"><i class="fas fa-check-circle text-success me-2"></i>Action Plan</h5>
                    <hr>
                    <div style="white-space: pre-wrap;">${formattedResponse}</div>
                </div>
            `;

        } catch (error) {
            console.error("Error:", error);
            aiContainer.innerHTML = `
                <div class="alert alert-danger">
                    <strong>Error:</strong> Could not connect to the agent.<br>
                    Make sure agent.py is running!
                </div>
            `;
        }
    }

    // Simple helper to remove raw markdown symbols if desired, 
    // or we just rely on pre-wrap css to show it nicely.
    function formatResponse(text) {
        // Basic cleanup if needed, but the pre-wrap style handles most markdown cleanly
        return text;
    }
    
</script>


   

</body>
</html>